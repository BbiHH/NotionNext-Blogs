<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4-7-8 呼吸冥想 (视觉引导)</title>
    <!-- 引入 Tailwind CSS (无需编译，即插即用) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 字体优化 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background-color: #f8fafc; /* slate-50 */
            overflow: hidden; /* 防止滚动条 */
        }

        /* 自定义动画关键帧 */
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob {
            animation: blob 15s infinite;
        }
        .animation-delay-2000 {
            animation-delay: 2s;
        }
        .animation-delay-4000 {
            animation-delay: 4s;
        }
        
        /* 呼吸圆环脉冲效果 */
        @keyframes ping-slow {
            0% { transform: scale(1); opacity: 0.6; }
            75%, 100% { transform: scale(1.5); opacity: 0; }
        }
        .animate-ping-slow {
            animation: ping-slow 3s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        /* 旋转微粒 */
        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 12s linear infinite;
        }

        /* 平滑过渡类 */
        .transition-smooth {
            transition-property: all;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>
<body class="text-slate-800 selection:bg-teal-200">

    <!-- 1. 背景光斑层 -->
    <div id="background-layer" class="absolute inset-0 overflow-hidden z-0 pointer-events-none">
        <div id="blob-1" class="absolute top-[-10%] left-[20%] w-[60vw] h-[60vw] rounded-full mix-blend-multiply filter blur-[80px] opacity-40 animate-blob bg-teal-200 transition-colors duration-1000"></div>
        <div id="blob-2" class="absolute top-[20%] right-[10%] w-[50vw] h-[50vw] rounded-full mix-blend-multiply filter blur-[80px] opacity-40 animate-blob animation-delay-2000 bg-emerald-100 transition-colors duration-1000"></div>
        <div id="blob-3" class="absolute bottom-[-20%] left-[30%] w-[50vw] h-[50vw] rounded-full mix-blend-multiply filter blur-[80px] opacity-40 animate-blob animation-delay-4000 bg-cyan-100 transition-colors duration-1000"></div>
        <!-- 噪点纹理 -->
        <div class="absolute inset-0 opacity-[0.03]" style="background-image: url('data:image/svg+xml,%3Csvg viewBox=\'0 0 200 200\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cfilter id=\'noiseFilter\'%3E%3CfeTurbulence type=\'fractalNoise\' baseFrequency=\'0.65\' numOctaves=\'3\' stitchTiles=\'stitch\'/%3E%3C/filter%3E%3Crect width=\'100%25\' height=\'100%25\' filter=\'url(%23noiseFilter)\'/%3E%3C/svg%3E')"></div>
    </div>

    <!-- 2. 顶部导航 -->
    <div class="absolute top-0 left-0 right-0 p-6 md:p-8 flex justify-between items-start z-40">
        <div class="flex items-center gap-3">
            <div class="bg-teal-500/10 p-2 rounded-lg backdrop-blur-sm border border-teal-500/20">
                <!-- Logo Icon (Wind) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-teal-600"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>
            </div>
            <div>
                <h1 class="text-slate-800 font-bold text-lg tracking-tight leading-tight">BREATH • WORK</h1>
                <p class="text-slate-500 text-[10px] md:text-xs uppercase tracking-widest">4-7-8 Meditation</p>
            </div>
        </div>
        <!-- 进度条 -->
        <div class="w-24 md:w-32 h-1 bg-slate-200 rounded-full overflow-hidden">
            <div id="global-progress" class="h-full bg-gradient-to-r from-teal-400 to-emerald-500 w-0 transition-all ease-linear duration-1000"></div>
        </div>
    </div>

    <!-- 3. 主体内容 -->
    <main class="relative z-10 w-full h-screen flex flex-col items-center justify-center">
        
        <!-- 状态指示器 (Inhale/Hold/Exhale) -->
        <div id="status-container" class="absolute top-[15%] md:top-[20%] left-0 right-0 flex justify-center z-30 transition-all duration-500 opacity-0 translate-y-[-20px]">
            <div class="flex items-center gap-2 px-4 py-2 bg-slate-900/5 rounded-full backdrop-blur-sm border border-slate-900/5">
                <span id="status-icon"></span>
                <span id="status-text" class="text-sm font-semibold tracking-widest text-slate-600">RELAX</span>
            </div>
        </div>

        <!-- 核心呼吸圆环 -->
        <div class="transform translate-y-[-5%] md:translate-y-[-5%] relative flex items-center justify-center w-96 h-96">
            
            <!-- Hold 阶段的脉冲光环 -->
            <div id="pulse-ring" class="absolute inset-0 rounded-full border-2 border-cyan-200 opacity-0 scale-100 transition-all duration-500"></div>

            <!-- 主圆环 -->
            <div id="breathing-circle" class="relative flex items-center justify-center w-64 h-64 rounded-full backdrop-blur-sm border-4 z-10 transition-smooth scale-100 bg-white/20 border-teal-100 shadow-[0_0_60px_rgba(20,184,166,0.1)]">
                <!-- 倒计时数字 -->
                <div id="count-display" class="text-6xl font-light tracking-tighter transition-opacity duration-500 opacity-0 select-none"></div>
                
                <!-- 装饰性内线 -->
                <div class="absolute inset-4 border border-white/30 rounded-full pointer-events-none"></div>
            </div>

            <!-- Exhale 阶段的粒子装饰 -->
            <div id="particles" class="absolute inset-0 pointer-events-none animate-spin-slow opacity-0 transition-opacity duration-1000">
                <div class="absolute top-0 left-1/2 w-2 h-2 bg-teal-300 rounded-full blur-[1px]"></div>
                <div class="absolute bottom-0 left-1/2 w-2 h-2 bg-blue-300 rounded-full blur-[1px]"></div>
                <div class="absolute left-0 top-1/2 w-2 h-2 bg-emerald-300 rounded-full blur-[1px]"></div>
            </div>
        </div>

    </main>

    <!-- 4. 字幕区域 -->
    <div class="absolute bottom-12 md:bottom-20 left-0 right-0 px-6 flex flex-col items-center justify-center text-center z-50">
        <div class="bg-white/60 backdrop-blur-md px-6 md:px-8 py-6 rounded-2xl shadow-sm border border-white/50 max-w-3xl w-full transition-all duration-700 ease-out transform" id="subtitle-box">
            <h2 id="subtitle-cn" class="text-xl md:text-3xl text-slate-800 font-medium mb-2 md:mb-3 tracking-wide leading-relaxed"></h2>
            <p id="subtitle-en" class="text-base md:text-xl text-slate-500 font-light font-sans tracking-wide"></p>
        </div>
    </div>

    <!-- 逻辑脚本 -->
    <script>
        // --- 数据配置 ---
        const SCRIPT = [
            // 第一章：引入
            { id: 'intro-1', duration: 4000, phase: 'idle', cn: "欢迎来到 4-7-8 呼吸冥想", en: "Welcome to the 4-7-8 Breathing Meditation" },
            { id: 'intro-2', duration: 5000, phase: 'idle', cn: "这是一种古老的瑜伽技巧，能像天然镇静剂一样抚慰神经。", en: "An ancient technique acting as a natural tranquilizer." },
            // 第二章：原理
            { id: 'theory-1', duration: 5000, phase: 'idle', cn: "通过特定的呼吸节奏，我们能强制重置自主神经系统。", en: "Specific rhythms can reset your autonomic nervous system." },
            // 第三章：规则
            { id: 'rule-1', duration: 5000, phase: 'prepare', cn: "规则很简单：吸气 4 秒，屏息 7 秒，呼气 8 秒。", en: "The rule is simple: Inhale 4s, Hold 7s, Exhale 8s." },
            { id: 'rule-2', duration: 4000, phase: 'prepare', cn: "坐直身体，放松肩膀。准备开始...", en: "Sit up straight, relax shoulders. Let's begin..." },
            // 第四章：循环 1
            { id: 'c1-inhale', duration: 4000, phase: 'inhale', count: 4, cn: "用鼻子吸气，感受能量...", en: "Inhale quietly through the nose..." },
            { id: 'c1-hold', duration: 7000, phase: 'hold', count: 7, cn: "屏住呼吸，感受内心的静止。", en: "Hold the breath. Feel the stillness." },
            { id: 'c1-exhale', duration: 8000, phase: 'exhale', count: 8, cn: "用嘴彻底呼气，释放压力。", en: "Exhale completely with a whoosh sound." },
            // 第五章：循环 2
            { id: 'c2-inhale', duration: 4000, phase: 'inhale', count: 4, cn: "再次吸气，充满肺部。", en: "Inhale again, filling your lungs." },
            { id: 'c2-hold', duration: 7000, phase: 'hold', count: 7, cn: "保持住，让氧气滋养全身。", en: "Hold. Let oxygen circulate." },
            { id: 'c2-exhale', duration: 8000, phase: 'exhale', count: 8, cn: "缓慢呼气，让身心完全松弛。", en: "Exhale slowly, letting go of everything." },
            // 第六章：循环 3 (加深)
            { id: 'c3-inhale', duration: 4000, phase: 'inhale', count: 4, cn: "最后一次，深深吸气。", en: "Last one. Deep inhale." },
            { id: 'c3-hold', duration: 7000, phase: 'hold', count: 7, cn: "感受这片刻的宁静。", en: "Savor this moment of peace." },
            { id: 'c3-exhale', duration: 8000, phase: 'exhale', count: 8, cn: "彻底释放...", en: "Release completely..." },
            // 结尾
            { id: 'outro-1', duration: 5000, phase: 'finished', cn: "做得很好。", en: "Well done." },
            { id: 'outro-2', duration: 60000, phase: 'finished', cn: "愿你拥有平静的一天。", en: "May you have a peaceful day." }
        ];

        // --- 图标 SVG 字符串 ---
        const ICONS = {
            sparkles: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-600"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>`,
            brain: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-600"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>`,
            wind: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-600"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>`,
            check: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-600"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>`,
            heart: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-slate-600"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>`
        };

        // --- DOM 元素引用 ---
        const els = {
            subtitleCn: document.getElementById('subtitle-cn'),
            subtitleEn: document.getElementById('subtitle-en'),
            circle: document.getElementById('breathing-circle'),
            countDisplay: document.getElementById('count-display'),
            statusContainer: document.getElementById('status-container'),
            statusText: document.getElementById('status-text'),
            statusIcon: document.getElementById('status-icon'),
            globalProgress: document.getElementById('global-progress'),
            pulseRing: document.getElementById('pulse-ring'),
            particles: document.getElementById('particles'),
            blobs: [document.getElementById('blob-1'), document.getElementById('blob-2'), document.getElementById('blob-3')]
        };

        // --- 状态变量 ---
        let currentIndex = 0;
        let totalDuration = SCRIPT.reduce((sum, item) => sum + item.duration, 0);
        let elapsedTime = 0;
        let countdownInterval = null;

        // --- 核心渲染函数 ---
        function renderScene(scriptItem) {
            // 1. 更新字幕
            els.subtitleCn.innerText = scriptItem.cn;
            els.subtitleEn.innerText = scriptItem.en;

            // 2. 更新状态指示器
            updateStatus(scriptItem.phase);

            // 3. 更新呼吸圆环视觉
            updateBreathingCore(scriptItem.phase, scriptItem.duration);

            // 4. 如果有计数，启动倒计时逻辑
            if (scriptItem.count) {
                startCountdown(scriptItem.count, scriptItem.duration);
            } else {
                stopCountdown();
                els.countDisplay.innerText = "";
                els.countDisplay.classList.add('opacity-0');
            }
        }

        function updateStatus(phase) {
            // 根据阶段显示顶部小胶囊
            let text = "", icon = "";
            let show = true;

            switch(phase) {
                case 'idle': text = "RELAX"; icon = ICONS.sparkles; show = false; break;
                case 'prepare': text = "PREPARE"; icon = ICONS.brain; show = true; break;
                case 'inhale': text = "INHALE (4s)"; icon = ICONS.wind; show = true; break;
                case 'hold': text = "HOLD (7s)"; icon = ICONS.check; show = true; break;
                case 'exhale': text = "EXHALE (8s)"; icon = ICONS.wind; show = true; break;
                case 'finished': text = "NAMASTE"; icon = ICONS.heart; show = true; break;
            }

            if (show) {
                els.statusContainer.classList.remove('opacity-0', 'translate-y-[-20px]');
                els.statusText.innerText = text;
                els.statusIcon.innerHTML = icon;
            } else {
                els.statusContainer.classList.add('opacity-0', 'translate-y-[-20px]');
            }
        }

        function updateBreathingCore(phase, duration) {
            // 重置基本样式
            const circle = els.circle;
            circle.style.transitionDuration = `${duration}ms`; // 动态设置动画时长匹配阶段时长

            // 清除所有特定阶段的类 (为了简单直接重置className, 但保留基础类)
            // 这里采用修改 Tailwind 类名的方式
            
            // 基础类
            let baseClasses = "relative flex items-center justify-center w-64 h-64 rounded-full backdrop-blur-sm border-4 z-10 transition-smooth";
            
            // 阶段特定类
            let phaseClasses = "";
            let pulseActive = false;
            let particlesActive = false;
            let textColor = "text-slate-800";

            // 背景颜色变化
            const blobs = els.blobs;

            if (phase === 'idle' || phase === 'finished') {
                phaseClasses = "scale-100 bg-teal-50/50 border-teal-100 shadow-[0_0_60px_rgba(20,184,166,0.1)]";
                blobs[0].className = blobs[0].className.replace(/bg-[\w]+-\d+/, 'bg-teal-200');
                
            } else if (phase === 'prepare') {
                phaseClasses = "scale-75 bg-teal-100/30 border-teal-200/50";
                circle.style.transitionDuration = "2000ms"; // 准备阶段固定时长
            
            } else if (phase === 'inhale') {
                // 吸气：变大，明亮
                phaseClasses = "scale-150 bg-gradient-to-br from-teal-100 to-emerald-200 shadow-[0_0_100px_rgba(52,211,153,0.4)] border-teal-300/50";
                textColor = "text-teal-800";
                blobs[0].className = blobs[0].className.replace(/bg-[\w]+-\d+/, 'bg-emerald-200');
                blobs[1].className = blobs[1].className.replace(/bg-[\w]+-\d+/, 'bg-teal-100');

            } else if (phase === 'hold') {
                // 屏息：保持大，脉冲，蓝色调
                phaseClasses = "scale-150 bg-gradient-to-br from-teal-200 to-cyan-200 shadow-[0_0_120px_rgba(34,211,238,0.6)] border-cyan-400";
                textColor = "text-cyan-900";
                pulseActive = true;
                circle.style.transitionDuration = "300ms"; // 快速切换颜色
                blobs[0].className = blobs[0].className.replace(/bg-[\w]+-\d+/, 'bg-cyan-200');

            } else if (phase === 'exhale') {
                // 呼气：变小，放松
                phaseClasses = "scale-75 bg-gradient-to-br from-blue-50 to-teal-50 shadow-[0_0_40px_rgba(94,234,212,0.2)] border-blue-200/30";
                textColor = "text-blue-800";
                particlesActive = true;
                circle.style.transitionDuration = `${duration}ms`;
                blobs[0].className = blobs[0].className.replace(/bg-[\w]+-\d+/, 'bg-blue-100');
            }

            // 应用类名
            circle.className = `${baseClasses} ${phaseClasses}`;
            
            // 设置文字颜色
            els.countDisplay.className = `text-6xl font-light tracking-tighter transition-opacity duration-500 opacity-100 ${textColor}`;

            // 处理 Hold 阶段的光环脉冲
            if (pulseActive) {
                els.pulseRing.classList.remove('opacity-0');
                els.pulseRing.classList.add('animate-ping-slow');
            } else {
                els.pulseRing.classList.add('opacity-0');
                els.pulseRing.classList.remove('animate-ping-slow');
            }

            // 处理 Exhale 阶段的粒子
            if (particlesActive) {
                els.particles.classList.remove('opacity-0');
            } else {
                els.particles.classList.add('opacity-0');
            }
        }

        function startCountdown(maxCount, durationMs) {
            stopCountdown();
            els.countDisplay.classList.remove('opacity-0');
            
            let startTime = Date.now();
            
            // 立即显示 1
            els.countDisplay.innerText = "1";

            countdownInterval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / durationMs, 1);
                
                // 计算当前数值 (1 到 maxCount)
                const currentVal = Math.ceil(progress * maxCount);
                
                if (currentVal <= maxCount) {
                    els.countDisplay.innerText = currentVal;
                }
                
                if (progress >= 1) stopCountdown();
            }, 50); // 50ms 更新一次保证平滑
        }

        function stopCountdown() {
            if (countdownInterval) clearInterval(countdownInterval);
        }

        // --- 主循环 ---
        function playSequence() {
            if (currentIndex >= SCRIPT.length) return;

            const currentItem = SCRIPT[currentIndex];
            
            // 渲染当前场景
            renderScene(currentItem);

            // 更新全局进度条
            const progressPercent = (elapsedTime / totalDuration) * 100;
            els.globalProgress.style.width = `${progressPercent}%`;

            // 只要不是最后一项，就设置定时器进入下一项
            if (currentIndex < SCRIPT.length - 1) {
                setTimeout(() => {
                    elapsedTime += currentItem.duration;
                    currentIndex++;
                    playSequence();
                }, currentItem.duration);
            } else {
                // 最后一项，进度条填满
                 els.globalProgress.style.width = `100%`;
            }
        }

        // --- 初始化 ---
        window.onload = () => {
            // 稍微延迟一点开始，让页面元素加载稳定
            setTimeout(playSequence, 500);
        };

    </script>
</body>
</html>